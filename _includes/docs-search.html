<!-- _includes/docs-search.html -->
<div class="docs-search">
  <input type="text" id="docs-search-input" placeholder="搜索文档...">
  <div id="docs-search-results" class="search-results"></div>
</div>

<style>
.docs-search {
  margin-bottom: 2rem;
  position: relative;
}

#docs-search-input {
  width: 100%;
  padding: 0.75rem;
  border: 1px solid #e1e4e8;
  border-radius: 6px;
  font-size: 1rem;
}

.search-results {
  position: absolute;
  top: 100%;
  left: 0;
  right: 0;
  background: white;
  border: 1px solid #e1e4e8;
  border-top: none;
  border-radius: 0 0 6px 6px;
  max-height: 300px;
  overflow-y: auto;
  z-index: 100;
  display: none;
}

.search-result-item {
  padding: 0.75rem;
  border-bottom: 1px solid #e1e4e8;
  text-decoration: none;
  color: #24292e;
  display: block;
}

.search-result-item:hover {
  background-color: #f6f8fa;
}

.search-result-title {
  font-weight: 600;
}

.search-result-category {
  font-size: 0.8rem;
  color: #6a737d;
}
</style>

<script>
document.addEventListener('DOMContentLoaded', function() {
  const searchInput = document.getElementById('docs-search-input');
  const searchResults = document.getElementById('docs-search-results');
  
  // 获取所有文档数据
  const docsData = [
    {% for page in site.pages %}
      {% if page.category %}
        {
          title: {{ page.title | jsonify }},
          url: {{ page.url | relative_url | jsonify }},
          category: {{ page.category | jsonify }},
          content: {{ page.content | strip_html | jsonify }}
        },
      {% endif %}
    {% endfor %}
  ];
  
  searchInput.addEventListener('input', function() {
    const query = this.value.trim().toLowerCase();
    
    if (query.length === 0) {
      searchResults.style.display = 'none';
      return;
    }
    
    const results = docsData.filter(doc => 
      doc.title.toLowerCase().includes(query) || 
      doc.content.toLowerCase().includes(query)
    );
    
    displayResults(results);
  });
  
  function displayResults(results) {
    if (results.length === 0) {
      searchResults.innerHTML = '<div class="search-result-item">未找到相关文档</div>';
    } else {
      searchResults.innerHTML = results.map(doc => `
        <a href="${doc.url}" class="search-result-item">
          <div class="search-result-title">${doc.title}</div>
          <div class="search-result-category">${doc.category}</div>
        </a>
      `).join('');
    }
    
    searchResults.style.display = 'block';
  }
  
  // 点击其他地方隐藏搜索结果
  document.addEventListener('click', function(e) {
    if (!searchInput.contains(e.target) && !searchResults.contains(e.target)) {
      searchResults.style.display = 'none';
    }
  });
});
</script>